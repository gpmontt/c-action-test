name: Code Formatting

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  format-check:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Install clang-format
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-format
    
    - name: Check code formatting
      run: |
        # Check if any C/H files need formatting
        find src inc tests -name "*.c" -o -name "*.h" | \
        xargs clang-format --dry-run --Werror || \
        (echo "Code formatting issues found. Run 'clang-format -i' on the files." && exit 1)
